From 693d612a9c85d53713c0b3ac58ff08c2bc068ddd Mon Sep 17 00:00:00 2001
From: Chris Rummel <crummel@microsoft.com>
Date: Mon, 14 Oct 2019 14:23:48 -0500
Subject: [PATCH] Remove some source-build specific stuff.

---
 build.proj                                      | 2 +-
 eng/Tools.props                                 | 9 ++++-----
 src/netstandard/pkg/NETStandard.Library.pkgproj | 2 +-
 3 files changed, 6 insertions(+), 7 deletions(-)

diff --git a/build.proj b/build.proj
index 279dfa1..bd73211 100644
--- a/build.proj
+++ b/build.proj
@@ -9,7 +9,7 @@
     <BuildPackages Condition="'$(BuildPackages)'==''">true</BuildPackages>
     <SignPackages Condition="'$(SignPackages)'==''">false</SignPackages>
 
-    <BuildDependsOn Condition="'$(BuildRestore)'=='true' and '$(DotNetBuildFromSource)'!='true'">$(BuildDependsOn);Restore</BuildDependsOn>
+    <BuildDependsOn Condition="'$(BuildRestore)'=='true'">$(BuildDependsOn);Restore</BuildDependsOn>
     <BuildDependsOn Condition="'$(BuildManaged)'=='true'">$(BuildDependsOn);BuildManaged</BuildDependsOn>
     <BuildDependsOn Condition="'$(BuildTests)'=='true' and '$(DotNetBuildFromSource)'!='true'">$(BuildDependsOn);Test</BuildDependsOn>
     <BuildDependsOn Condition="'$(BuildPackages)'=='true'">$(BuildDependsOn);Pack</BuildDependsOn>
diff --git a/eng/Tools.props b/eng/Tools.props
index 7086c17..b934281 100644
--- a/eng/Tools.props
+++ b/eng/Tools.props
@@ -16,6 +16,10 @@
     <PackageReference Include="Microsoft.DotNet.Build.Tasks.Packaging" Version="$(MicrosoftDotNetBuildTasksPackagingPackageVersion)" />
     <PackageReference Include="Microsoft.DotNet.CodeAnalysis" Version="$(MicrosoftDotNetCodeAnalysisPackageVersion)" />
     <PackageReference Include="Microsoft.DotNet.GenFacades" Version="$(MicrosoftDotNetGenFacadesPackageVersion)" />
+
+    <!-- SourceLink -->
+    <PackageReference Include="Microsoft.SourceLink.GitHub" Version="$(MicrosoftSourceLinkVersion)" PrivateAssets="all" IsImplicitlyDefined="true" />
+    <PackageReference Include="Microsoft.SourceLink.Vsts.Git" Version="$(MicrosoftSourceLinkVersion)" PrivateAssets="all" IsImplicitlyDefined="true" />
   </ItemGroup>
 
   <!-- excluded from source build -->
@@ -27,10 +31,6 @@
     <!-- XML docs -->
     <PackageReference Include="$(XmlDocPackage)" Version="$(XmlDocPackageVersion)" />
 
-    <!-- SourceLink -->
-    <PackageReference Include="Microsoft.SourceLink.GitHub" Version="$(MicrosoftSourceLinkVersion)" PrivateAssets="all" IsImplicitlyDefined="true" />
-    <PackageReference Include="Microsoft.SourceLink.Vsts.Git" Version="$(MicrosoftSourceLinkVersion)" PrivateAssets="all" IsImplicitlyDefined="true" />
-
     <!-- last NETStandard package for harvesting -->
     <PackageReference Include="$(NetStandardLibraryPackage)" Version="$(NetStandardLibraryPackageVersion)" ExcludeAssets="All" />
 
@@ -51,7 +51,6 @@
 
   <!-- the intellisense package doesn't use nuget conventions so we need to select manually -->
   <Target Name="GetDocFiles"
-          Condition="'$(DotNetBuildFromSource)' != 'true'"
           AfterTargets="Restore">
     <ItemGroup>
       <DocFile Include="$(XmlDocFileRoot)/**/*.xml"/>
diff --git a/src/netstandard/pkg/NETStandard.Library.pkgproj b/src/netstandard/pkg/NETStandard.Library.pkgproj
index 2814a62..ba857ec 100644
--- a/src/netstandard/pkg/NETStandard.Library.pkgproj
+++ b/src/netstandard/pkg/NETStandard.Library.pkgproj
@@ -42,7 +42,7 @@
   </ItemGroup>
 
   <Target Name="EnsureRestoredNetStandardAssets" BeforeTargets="GenerateNuSpec">
-    <Error Condition="'@(NetStandard20Files)' == ''AND '$(DotNetBuildFromSource)' != 'true'" Text="Could not find package assets for netstandard2.0"  />
+    <Error Condition="'@(NetStandard20Files)' == ''" Text="Could not find package assets for netstandard2.0"  />
   </Target>
 
   <Target Name="StampTargets" BeforeTargets="GenerateNuSpec">
-- 
2.18.0

