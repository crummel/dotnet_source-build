From bdb9e700339344537b96bfc2d6b28d7e89dc46ec Mon Sep 17 00:00:00 2001
From: Chris Rummel <crummel@microsoft.com>
Date: Thu, 3 Sep 2020 06:29:25 -0500
Subject: [PATCH 13/13] Fix a couple issues.

---
 AspNetCore.sln                                |  2 --
 src/Components/Components.slnf                |  1 -
 src/Components/ComponentsNoDeps.slnf          |  3 +-
 .../Driver/Wasm.Performance.Driver.csproj     | 32 -------------------
 .../Microsoft.JSInterop/src/JSRuntime.cs      |  2 +-
 5 files changed, 2 insertions(+), 38 deletions(-)
 delete mode 100644 src/Components/benchmarkapps/Wasm.Performance/Driver/Wasm.Performance.Driver.csproj

diff --git a/AspNetCore.sln b/AspNetCore.sln
index d5fda15eba..529be82b05 100644
--- a/AspNetCore.sln
+++ b/AspNetCore.sln
@@ -483,8 +483,6 @@ Project("{2150E333-8FDC-42A3-9474-1A3956D46DE8}") = "benchmarkapps", "benchmarka
 EndProject
 Project("{2150E333-8FDC-42A3-9474-1A3956D46DE8}") = "Wasm.Performance", "Wasm.Performance", "{6276A9A0-791B-49C1-AD8F-50AC47CDC196}"
 EndProject
-Project("{9A19103F-16F7-4668-BE54-9A1E7A4F7556}") = "Wasm.Performance.Driver", "src\Components\benchmarkapps\Wasm.Performance\Driver\Wasm.Performance.Driver.csproj", "{B81C7FA1-870F-4F21-A928-A5BE18754E6E}"
-EndProject
 Project("{9A19103F-16F7-4668-BE54-9A1E7A4F7556}") = "Wasm.Performance.TestApp", "src\Components\benchmarkapps\Wasm.Performance\TestApp\Wasm.Performance.TestApp.csproj", "{2AEACF69-7F68-414A-B49D-2C627D37D0F6}"
 EndProject
 Project("{9A19103F-16F7-4668-BE54-9A1E7A4F7556}") = "Microsoft.AspNetCore.Components.WebAssembly.Server.Tests", "src\Components\WebAssembly\Server\test\Microsoft.AspNetCore.Components.WebAssembly.Server.Tests.csproj", "{0C610220-E00C-4752-98A0-44A3D4B96A21}"
diff --git a/src/Components/Components.slnf b/src/Components/Components.slnf
index 637ec1a384..9bb64a3495 100644
--- a/src/Components/Components.slnf
+++ b/src/Components/Components.slnf
@@ -98,7 +98,6 @@
       "src\\Components\\Ignitor\\src\\Ignitor.csproj",
       "src\\Components\\Ignitor\\test\\Ignitor.Test.csproj",
       "src\\Components\\test\\testassets\\ComponentsApp.Server\\ComponentsApp.Server.csproj",
-      "src\\Components\\benchmarkapps\\Wasm.Performance\\Driver\\Wasm.Performance.Driver.csproj",
       "src\\Components\\benchmarkapps\\Wasm.Performance\\TestApp\\Wasm.Performance.TestApp.csproj",
       "src\\Components\\Web.Extensions\\src\\Microsoft.AspNetCore.Components.Web.Extensions.csproj",
       "src\\Components\\Web.Extensions\\test\\Microsoft.AspNetCore.Components.Web.Extensions.Tests.csproj",
diff --git a/src/Components/ComponentsNoDeps.slnf b/src/Components/ComponentsNoDeps.slnf
index dd08970d02..34e5619a94 100644
--- a/src/Components/ComponentsNoDeps.slnf
+++ b/src/Components/ComponentsNoDeps.slnf
@@ -37,7 +37,6 @@
       "src\\Components\\WebAssembly\\Sdk\\integrationtests\\Microsoft.NET.Sdk.BlazorWebAssembly.IntegrationTests.csproj",
       "src\\Components\\Web\\src\\Microsoft.AspNetCore.Components.Web.csproj",
       "src\\Components\\Web\\test\\Microsoft.AspNetCore.Components.Web.Tests.csproj",
-      "src\\Components\\benchmarkapps\\Wasm.Performance\\Driver\\Wasm.Performance.Driver.csproj",
       "src\\Components\\benchmarkapps\\Wasm.Performance\\TestApp\\Wasm.Performance.TestApp.csproj",
       "src\\Components\\test\\E2ETest\\Microsoft.AspNetCore.Components.E2ETests.csproj",
       "src\\Components\\test\\testassets\\BasicTestApp\\BasicTestApp.csproj",
@@ -46,4 +45,4 @@
       "src\\Components\\test\\testassets\\TestServer\\Components.TestServer.csproj"
     ]
   }
-}
\ No newline at end of file
+}
diff --git a/src/Components/benchmarkapps/Wasm.Performance/Driver/Wasm.Performance.Driver.csproj b/src/Components/benchmarkapps/Wasm.Performance/Driver/Wasm.Performance.Driver.csproj
deleted file mode 100644
index 66aea279ee..0000000000
--- a/src/Components/benchmarkapps/Wasm.Performance/Driver/Wasm.Performance.Driver.csproj
+++ /dev/null
@@ -1,32 +0,0 @@
-<Project Sdk="Microsoft.NET.Sdk.Web">
-
-  <PropertyGroup>
-    <TargetFramework>$(DefaultNetCoreTargetFramework)</TargetFramework>
-    <OutputType>exe</OutputType>
-
-    <IsShippingPackage>false</IsShippingPackage>
-    <!-- WebDriver is not strong-named, so this test project cannot be strong named either. -->
-    <SignAssembly>false</SignAssembly>
-    <IsTestAssetProject>true</IsTestAssetProject>
-    <RuntimeIdentifier>linux-x64</RuntimeIdentifier>
-  </PropertyGroup>
-
-  <ItemGroup>
-    <Reference Include="Microsoft.AspNetCore.Cors" />
-    <Reference Include="Selenium.Support" />
-    <Reference Include="Selenium.WebDriver" />
-    <ProjectReference Include="..\..\..\WebAssembly\DevServer\src\Microsoft.AspNetCore.Components.WebAssembly.DevServer.csproj" />
-    <ProjectReference Include="..\TestApp\Wasm.Performance.TestApp.csproj" />
-  </ItemGroup>
-
-  <Target Name="_AddTestProjectMetadataAttributes" BeforeTargets="BeforeCompile">
-    <ItemGroup>
-      <AssemblyAttribute
-        Include="System.Reflection.AssemblyMetadataAttribute">
-        <_Parameter1>TestAppLocatiion</_Parameter1>
-        <_Parameter2>$(MSBuildThisFileDirectory)..\TestApp\</_Parameter2>
-      </AssemblyAttribute>
-  </ItemGroup>
-  </Target>
-
-</Project>
diff --git a/src/JSInterop/Microsoft.JSInterop/src/JSRuntime.cs b/src/JSInterop/Microsoft.JSInterop/src/JSRuntime.cs
index b59e987686..b18e53e916 100644
--- a/src/JSInterop/Microsoft.JSInterop/src/JSRuntime.cs
+++ b/src/JSInterop/Microsoft.JSInterop/src/JSRuntime.cs
@@ -88,7 +88,7 @@ namespace Microsoft.JSInterop
         public ValueTask<TValue> InvokeAsync<TValue>(string identifier, CancellationToken cancellationToken, object[] args)
         {
             var taskId = Interlocked.Increment(ref _nextPendingTaskId);
-            var tcs = new TaskCompletionSource<TValue>(TaskContinuationOptions.RunContinuationsAsynchronously);
+            var tcs = new TaskCompletionSource<TValue>(TaskCreationOptions.RunContinuationsAsynchronously);
             if (cancellationToken != default)
             {
                 _cancellationRegistrations[taskId] = cancellationToken.Register(() =>
-- 
2.18.0

